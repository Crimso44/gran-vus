'SELECT PERSON.*,
  IIF(ISNULL(d.DEP_FULL_NAME) OR d.DEP_FULL_NAME="", d.DEP_NAME, d.DEP_FULL_NAME) as DEP_NAME,
  p.POST_NAME, Year(PERSON.BIRTHDAY) as BirthYear, w.WRNG_NAME,
  IIF(PERSON.WUCHET2 is null, 'общий', 'специальный') + IIF(PERSON.WUCHET1 is null, '', ', ' + PERSON.WUCHET1) + IIF(PERSON.WUCHET2 is null, '', ', ' + PERSON.WUCHET2) as WUCHET,
  o.OVK_NAME, IIF(a1.POST_CODE is null, '', CStr(a1.POST_CODE) + ', ') + a1.ADDR_STR as ADDR1,
  IIF(a2.POST_CODE is null, '', CStr(a2.POST_CODE) + ', ') + a2.ADDR_STR as ADDR2,
  ed.ED_NAME
FROM (((((((PERSON
LEFT OUTER JOIN AppointmentLast app
    ON app.PERS_ID = PERSON.PERS_ID)
LEFT OUTER JOIN KDEPART d
    ON app.DEP_ID = d.DEP_ID)
LEFT OUTER JOIN KPOST p
    ON app.POST_ID = p.POST_ID)
LEFT OUTER JOIN KWRANGE w
    ON PERSON.WRNG_ID = w.WRNG_ID)
LEFT OUTER JOIN KOVK o
    ON o.OVK_ID = PERSON.OVK_ID)
LEFT OUTER JOIN ADDR a1
    ON (a1.PERS_ID = PERSON.PERS_ID and a1.ADDR_TYPE = 0))
LEFT OUTER JOIN ADDR a2
    ON (a2.PERS_ID = PERSON.PERS_ID and a2.ADDR_TYPE = 1)
LEFT OUTER JOIN KEDUC ed
    ON ed.ED_ID = PERSON.ED_ID)
WHERE PERSON.ORG_ID = :ORG_ID
  AND ((select COUNT(*) from PERS_SET)=0
   OR PERSON.PERS_ID in (select PERS_ID from PERS_SET))
 ORDER BY
NUMB_T2'#$D#$A